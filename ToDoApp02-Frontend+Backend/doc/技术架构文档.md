# 待办事项应用技术架构文档

## 1. 项目概述

### 1.1 项目简介
本项目是一个现代化的待办事项管理应用，支持任务的增删改查、状态管理、筛选和批量操作功能。

### 1.2 技术栈
- **前端**: React 18.x
- **后端**: FastAPI (Python 3.8+)
- **数据库**: SQLite
- **样式**: CSS3 (现代响应式设计)

### 1.3 项目结构
```
ToDoApp02-system/
├── backend/                 # 后端服务
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py         # FastAPI应用入口
│   │   ├── models/         # 数据模型
│   │   ├── routers/        # API路由
│   │   ├── database.py     # 数据库配置
│   │   └── schemas.py      # Pydantic模型
│   ├── requirements.txt    # Python依赖
│   └── README.md
├── frontend/               # 前端应用
│   ├── public/
│   ├── src/
│   │   ├── components/     # React组件
│   │   ├── services/       # API服务
│   │   ├── styles/         # 样式文件
│   │   └── utils/          # 工具函数
│   ├── package.json
│   └── README.md
└── docs/                   # 文档
    └── 技术架构文档.md
```

## 2. 数据库设计

### 2.1 表结构设计

#### 2.1.1 待办事项表 (todos)
```sql
-- 创建待办事项表
CREATE TABLE todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_todos_completed ON todos(completed);
CREATE INDEX idx_todos_created_at ON todos(created_at);

-- 创建更新时间触发器
CREATE TRIGGER update_todos_timestamp 
    AFTER UPDATE ON todos
    FOR EACH ROW
BEGIN
    UPDATE todos SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
END;
```

### 2.2 数据库初始化脚本
```sql
-- 初始化数据库脚本 (init_db.sql)
-- 删除已存在的表（开发环境）
DROP TABLE IF EXISTS todos;

-- 创建待办事项表
CREATE TABLE todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_todos_completed ON todos(completed);
CREATE INDEX idx_todos_created_at ON todos(created_at);

-- 创建更新时间触发器
CREATE TRIGGER update_todos_timestamp 
    AFTER UPDATE ON todos
    FOR EACH ROW
BEGIN
    UPDATE todos SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
END;

-- 插入示例数据
INSERT INTO todos (title, description, completed) VALUES
('学习React', '完成React基础教程', FALSE),
('项目规划', '制定项目开发计划', TRUE),
('代码审查', '审查团队代码提交', FALSE);
```

## 3. 后端API设计 (FastAPI)

### 3.1 数据模型 (Pydantic Schemas)

```python
# schemas.py
from pydantic import BaseModel
from datetime import datetime
from typing import Optional

class TodoBase(BaseModel):
    title: str
    description: Optional[str] = None

class TodoCreate(TodoBase):
    pass

class TodoUpdate(BaseModel):
    title: Optional[str] = None
    description: Optional[str] = None
    completed: Optional[bool] = None

class TodoResponse(TodoBase):
    id: int
    completed: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class TodoListResponse(BaseModel):
    todos: list[TodoResponse]
    total: int
    completed_count: int
    pending_count: int
```

### 3.2 数据库模型

```python
# models/todo.py
from sqlalchemy import Column, Integer, String, Boolean, DateTime
from sqlalchemy.sql import func
from database import Base

class Todo(Base):
    __tablename__ = "todos"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(255), nullable=False)
    description = Column(String, nullable=True)
    completed = Column(Boolean, default=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
```

### 3.3 API接口规范

#### 3.3.1 基础信息
- **Base URL**: `http://localhost:8000/api/v1`
- **Content-Type**: `application/json`
- **认证方式**: 暂无需认证（后续可扩展JWT）

#### 3.3.2 接口列表

##### 1. 获取待办事项列表
```http
GET /todos
```

**查询参数:**
- `status` (optional): `all` | `completed` | `pending` (默认: `all`)
- `page` (optional): 页码 (默认: 1)
- `limit` (optional): 每页数量 (默认: 50)

**响应示例:**
```json
{
  "todos": [
    {
      "id": 1,
      "title": "学习React",
      "description": "完成React基础教程",
      "completed": false,
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ],
  "total": 1,
  "completed_count": 0,
  "pending_count": 1
}
```

##### 2. 创建待办事项
```http
POST /todos
```

**请求体:**
```json
{
  "title": "新任务",
  "description": "任务描述（可选）"
}
```

**响应示例:**
```json
{
  "id": 2,
  "title": "新任务",
  "description": "任务描述（可选）",
  "completed": false,
  "created_at": "2024-01-15T11:00:00Z",
  "updated_at": "2024-01-15T11:00:00Z"
}
```

##### 3. 更新待办事项
```http
PUT /todos/{todo_id}
```

**请求体:**
```json
{
  "title": "更新后的标题",
  "description": "更新后的描述",
  "completed": true
}
```

**响应示例:**
```json
{
  "id": 1,
  "title": "更新后的标题",
  "description": "更新后的描述",
  "completed": true,
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T11:15:00Z"
}
```

##### 4. 删除待办事项
```http
DELETE /todos/{todo_id}
```

**响应:**
```json
{
  "message": "待办事项已删除",
  "id": 1
}
```

##### 5. 批量删除已完成事项
```http
DELETE /todos/completed
```

**响应:**
```json
{
  "message": "已删除3个已完成的事项",
  "deleted_count": 3
}
```

##### 6. 清空所有事项
```http
DELETE /todos/all
```

**响应:**
```json
{
  "message": "已清空所有事项",
  "deleted_count": 5
}
```

### 3.4 错误响应格式

```json
{
  "detail": "错误描述",
  "error_code": "ERROR_CODE",
  "timestamp": "2024-01-15T11:00:00Z"
}
```

**常见错误码:**
- `TODO_NOT_FOUND`: 待办事项不存在
- `VALIDATION_ERROR`: 请求参数验证失败
- `INTERNAL_ERROR`: 服务器内部错误

## 4. 前端架构设计 (React)

### 4.1 组件结构

```
src/
├── components/
│   ├── TodoApp.jsx          # 主应用组件
│   ├── TodoForm.jsx         # 添加任务表单
│   ├── TodoList.jsx         # 任务列表
│   ├── TodoItem.jsx         # 单个任务项
│   ├── FilterBar.jsx        # 筛选栏
│   ├── ActionBar.jsx        # 操作栏（清除按钮）
│   └── LoadingSpinner.jsx   # 加载动画
├── services/
│   └── api.js              # API服务封装
├── hooks/
│   ├── useTodos.js         # 待办事项状态管理
│   └── useApi.js           # API调用Hook
├── styles/
│   ├── main.css            # 主样式
│   ├── components.css      # 组件样式
│   └── responsive.css      # 响应式样式
└── utils/
    ├── constants.js        # 常量定义
    └── helpers.js          # 工具函数
```

### 4.2 状态管理

使用React Hooks进行状态管理：

```javascript
// hooks/useTodos.js
import { useState, useEffect } from 'react';
import { todoApi } from '../services/api';

export const useTodos = () => {
  const [todos, setTodos] = useState([]);
  const [loading, setLoading] = useState(false);
  const [filter, setFilter] = useState('all'); // all, completed, pending
  
  const fetchTodos = async (status = 'all') => {
    setLoading(true);
    try {
      const response = await todoApi.getTodos(status);
      setTodos(response.todos);
    } catch (error) {
      console.error('获取待办事项失败:', error);
    } finally {
      setLoading(false);
    }
  };
  
  const addTodo = async (todoData) => {
    try {
      const newTodo = await todoApi.createTodo(todoData);
      setTodos(prev => [...prev, newTodo]);
    } catch (error) {
      console.error('添加待办事项失败:', error);
    }
  };
  
  const updateTodo = async (id, updates) => {
    try {
      const updatedTodo = await todoApi.updateTodo(id, updates);
      setTodos(prev => prev.map(todo => 
        todo.id === id ? updatedTodo : todo
      ));
    } catch (error) {
      console.error('更新待办事项失败:', error);
    }
  };
  
  const deleteTodo = async (id) => {
    try {
      await todoApi.deleteTodo(id);
      setTodos(prev => prev.filter(todo => todo.id !== id));
    } catch (error) {
      console.error('删除待办事项失败:', error);
    }
  };
  
  const clearCompleted = async () => {
    try {
      await todoApi.clearCompleted();
      setTodos(prev => prev.filter(todo => !todo.completed));
    } catch (error) {
      console.error('清除已完成事项失败:', error);
    }
  };
  
  const clearAll = async () => {
    try {
      await todoApi.clearAll();
      setTodos([]);
    } catch (error) {
      console.error('清空所有事项失败:', error);
    }
  };
  
  return {
    todos,
    loading,
    filter,
    setFilter,
    fetchTodos,
    addTodo,
    updateTodo,
    deleteTodo,
    clearCompleted,
    clearAll
  };
};
```

### 4.3 API服务封装

```javascript
// services/api.js
const API_BASE_URL = 'http://localhost:8000/api/v1';

class ApiService {
  constructor(baseURL) {
    this.baseURL = baseURL;
  }
  
  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const config = {
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
      ...options,
    };
    
    try {
      const response = await fetch(url, config);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('API请求失败:', error);
      throw error;
    }
  }
  
  async getTodos(status = 'all') {
    return this.request(`/todos?status=${status}`);
  }
  
  async createTodo(todoData) {
    return this.request('/todos', {
      method: 'POST',
      body: JSON.stringify(todoData),
    });
  }
  
  async updateTodo(id, updates) {
    return this.request(`/todos/${id}`, {
      method: 'PUT',
      body: JSON.stringify(updates),
    });
  }
  
  async deleteTodo(id) {
    return this.request(`/todos/${id}`, {
      method: 'DELETE',
    });
  }
  
  async clearCompleted() {
    return this.request('/todos/completed', {
      method: 'DELETE',
    });
  }
  
  async clearAll() {
    return this.request('/todos/all', {
      method: 'DELETE',
    });
  }
}

export const todoApi = new ApiService(API_BASE_URL);
```

### 4.4 样式设计规范

#### 4.4.1 设计原则
- **现代简洁**: 采用扁平化设计风格
- **响应式**: 支持移动端和桌面端
- **可访问性**: 符合WCAG 2.1标准
- **一致性**: 统一的颜色、字体、间距规范

#### 4.4.2 颜色方案
```css
:root {
  /* 主色调 */
  --primary-color: #3b82f6;
  --primary-hover: #2563eb;
  --primary-light: #dbeafe;
  
  /* 功能色 */
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
  
  /* 中性色 */
  --gray-50: #f9fafb;
  --gray-100: #f3f4f6;
  --gray-200: #e5e7eb;
  --gray-300: #d1d5db;
  --gray-400: #9ca3af;
  --gray-500: #6b7280;
  --gray-600: #4b5563;
  --gray-700: #374151;
  --gray-800: #1f2937;
  --gray-900: #111827;
  
  /* 背景色 */
  --bg-primary: #ffffff;
  --bg-secondary: var(--gray-50);
  --bg-tertiary: var(--gray-100);
  
  /* 文字色 */
  --text-primary: var(--gray-900);
  --text-secondary: var(--gray-600);
  --text-muted: var(--gray-400);
}
```

#### 4.4.3 布局规范
```css
/* 主容器 */
.app-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem 1rem;
  min-height: 100vh;
}

/* 卡片样式 */
.card {
  background: var(--bg-primary);
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 1.5rem;
  margin-bottom: 1rem;
}

/* 按钮样式 */
.btn {
  padding: 0.5rem 1rem;
  border-radius: 8px;
  border: none;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-primary {
  background: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-hover);
  transform: translateY(-1px);
}

/* 输入框样式 */
.input {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid var(--gray-200);
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.2s ease;
}

.input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px var(--primary-light);
}
```

## 5. 部署方案

### 5.1 开发环境

#### 后端启动
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### 前端启动
```bash
cd frontend
npm install
npm start
```

### 5.2 生产环境

#### Docker部署
```dockerfile
# backend/Dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

```dockerfile
# frontend/Dockerfile
FROM node:16-alpine

WORKDIR /app
COPY package*.json ./
RUN npm install

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=0 /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 5.3 环境配置

#### 后端环境变量
```env
# .env
DATABASE_URL=sqlite:///./todos.db
DEBUG=True
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
```

#### 前端环境变量
```env
# .env
REACT_APP_API_URL=http://localhost:8000/api/v1
```

## 6. 开发规范

### 6.1 代码规范
- **Python**: 遵循PEP 8规范，使用Black格式化
- **JavaScript**: 使用ESLint + Prettier
- **CSS**: 使用BEM命名规范

### 6.2 Git工作流
- 主分支: `main`
- 开发分支: `develop`
- 功能分支: `feature/功能名称`
- 修复分支: `hotfix/问题描述`

### 6.3 测试策略
- **后端**: 使用pytest进行单元测试和集成测试
- **前端**: 使用Jest + React Testing Library
- **API**: 使用Postman或Newman进行API测试

## 7. 性能优化

### 7.1 前端优化
- 使用React.memo减少不必要的重渲染
- 实现虚拟滚动处理大量数据
- 使用懒加载优化首屏加载时间
- 启用Gzip压缩

### 7.2 后端优化
- 使用数据库连接池
- 实现API响应缓存
- 添加数据库查询优化
- 使用异步处理提高并发性能

## 8. 安全考虑

### 8.1 数据安全
- 输入数据验证和清理
- SQL注入防护
- XSS攻击防护
- CSRF保护

### 8.2 API安全
- 请求频率限制
- 错误信息脱敏
- HTTPS强制使用
- 跨域资源共享(CORS)配置

## 9. 监控和日志

### 9.1 日志记录
- 结构化日志输出
- 不同级别的日志分类
- 错误日志告警机制

### 9.2 性能监控
- API响应时间监控
- 数据库查询性能监控
- 前端页面加载时间监控

---

**文档版本**: v1.0  
**创建日期**: 2024-01-15  
**最后更新**: 2024-01-15  
**维护人员**: 开发团队
